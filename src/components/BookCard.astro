---
import { Image } from "astro:assets"
import type { CollectionEntry } from "astro:content"
import { format } from "date-fns"
import BookRating from "./BookRating.astro"
import TagsList from "./TagsList.astro"
import Card from "./Card.astro"

type Props = {
  book: CollectionEntry<"books">
}

const {
  book: {
    slug,
    data: { ISBN, tags, title, dateAdded: date, myRating, author, myReview },
  },
} = Astro.props
---

<Card hover class="group">
  <div class="grid grid-cols-[140px_1fr] gap-[var(--space-6)] p-[var(--space-6)]">
    <div
      class="book-cover relative aspect-[2/3] w-[140px] overflow-hidden rounded-[var(--radius-md)] bg-[hsl(var(--muted))] shadow-[var(--shadow-md)] transition-transform duration-[var(--transition-slow)] group-hover:scale-105"
    >
      {
        ISBN ? (
          <Image
            class="h-full w-full object-cover"
            src={`https://covers.openlibrary.org/b/isbn/${ISBN}-M.jpg`}
            width={140}
            height={210}
            alt={`Cover of ${title} by ${author}`}
            loading="lazy"
            decoding="async"
          />
        ) : (
          <div class="flex h-full w-full items-center justify-center">
            <svg
              class="h-16 w-16 text-[hsl(var(--muted-foreground))]"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20" />
            </svg>
          </div>
        )
      }
    </div>

    <div class="flex flex-col justify-between">
      <div class="space-y-[var(--space-2)]">
        <a href={`/books/${slug}/`} class="block hover:bg-transparent">
          <h2
            class="text-xl font-semibold leading-tight text-[hsl(var(--foreground))] group-hover:text-[hsl(var(--primary))] transition-colors duration-[var(--transition-fast)]"
          >
            {title}
          </h2>
        </a>

        <p class="text-sm italic text-[hsl(var(--muted-foreground))]">
          by {author}
        </p>

        <div class="flex items-center gap-[var(--space-3)]">
          <BookRating rating={myRating} />
          <span class="text-sm text-[hsl(var(--muted-foreground))]">
            {format(new Date(date), "MMMM dd, yyyy")}
          </span>
        </div>

        <TagsList tags={tags} />

        {
          myReview && (
            <p class="mt-4 line-clamp-2 text-sm italic text-[hsl(var(--muted-foreground))]">
              "{myReview}"
            </p>
          )
        }
      </div>

      <a
        href={`/books/${slug}/`}
        class="mt-[var(--space-4)] inline-flex items-center gap-[var(--space-1)] text-sm font-medium text-[hsl(var(--primary))] hover:gap-[var(--space-2)] transition-all duration-[var(--transition-fast)] hover:bg-transparent"
      >
        Read more
        <svg
          class="h-4 w-4 transition-transform duration-[var(--transition-fast)]"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M5 12h14M12 5l7 7-7 7"></path>
        </svg>
      </a>
    </div>
  </div>
</Card>
